<mat-card class="m-2">
    <mat-card-content>
        <div class="flex justify-content-between align-items-center gap-8 font-bold">
            <div> P.A: {{ infoDirector[0].NombreProgramaAcademico }} </div>
            <div class="flex-grow-1 text-center"> Curso: {{ cursoAperturado().nombreCurso}} </div>
            <div class="text-right">Sección: {{ obtenerSiguienteSeccion() }} </div>
        </div>
        <mat-divider></mat-divider>

        @if(!loading){
            <div>
                <form class="p-3" [formGroup]="formSeccion">
                    <div class="flex gap-2">
                        <mat-checkbox (change)="toggleObservacion()"></mat-checkbox>
                        <ui-input class="w-full" label="Observación" formControlName="observacion"
                            [readonly]="!checkboxChecked" [maxlength]="maxLengthObservacion"></ui-input>
                    </div>
                    <div class="flex gap-2">
                        <div>
                            <span class="border-round font-bold" [ngClass]="{'bg-red-200 text-red-700': !formSeccion.get('discapacidad')?.value
                                ,'bg-green-200 text-green-700': formSeccion.get('discapacidad')?.value
                            }">DISCAPACIDAD</span>
                            <mat-slide-toggle formControlName="discapacidad"></mat-slide-toggle>
                        </div>
                        <ui-input class="w-full" label="Vacantes" formControlName="vacantes" [maxlength]="maxLengthVacantes"
                            [min]="minVacantes" [expReg]="expRegVacantesBlockToInput"></ui-input>
                    </div>
                    @if (seccionEdit.ambiente.length == 0) {
                        <mat-form-field class="w-full pb-2">
                            <mat-label>FORMATO</mat-label>
                            <mat-select (selectionChange)="seleccionarFormato($event)" formControlName="formato">
                                @for (formato of listaFormato(); track formato) {
                                <mat-option [value]="formato.idFormato">
                                    {{ formato.nombreFormato }}
                                </mat-option>
                                }
                            </mat-select>
                        </mat-form-field>
                        <mat-form-field class="w-full">
                            <mat-label>Tipo de Ambiente</mat-label>
                            <mat-select [formControl]="formSelectedTipo" multiple
                                (selectionChange)="updateSelectedAmbiente()" #select>
                                <mat-select-trigger>
                                    {{''}}
                                </mat-select-trigger>
                                @for (option of listarTipoAmbiente(); track option) {
                                <mat-option [value]="option"
                                [disabled]="isTipoAmbienteDisabled(option)">
                                    {{ option.nombreTipoAmbiente }}
                                </mat-option>
                                }
                            </mat-select>
                            @for (tipoSeleccionado of selectedChips; track $index) {
                            <mat-chip removable="true" (removed)="removerTipoAmbienteSeleccionado(tipoSeleccionado)">
                                {{ tipoSeleccionado.nombreTipoAmbiente }}
                                <mat-icon matChipRemove>cancel</mat-icon>
                            </mat-chip>
                            }
                        </mat-form-field>
                    <!-- </div> -->
                    @if(mostrarCantidadGrupos){
                        <ui-input class="w-full" label="Vacantes" formControlName="nGrupos" [maxlength]="maxLengthVacantes"
                            [min]="minVacantes" [expReg]="expRegVacantesBlockToInput"></ui-input>
                    }
                    }
    
                    @else {
                    <mat-card>
                        <div class="ml-2 font-bold text-base p-2">
                            {{ seccionEdit.ambiente[0]?.nombreFormato }}
                        </div>
                        <mat-divider></mat-divider>
                        @for (tipoAmbiente of seccionEdit.ambiente; track $index) {
                        <div class="flex justify-content-between text-base">
                            <mat-card-content>
                                {{ tipoAmbiente.nombreTipoAmbiente }}
                            </mat-card-content>
                            <ui-button color="red" icon="ti ti-trash f-18" class="m-2"
                                (onClick)="eliminarTipoEstudioConfirm(seccionEdit, tipoAmbiente.idTipoAmbiente)">
                            </ui-button>
                        </div>
                        }
                        <mat-divider></mat-divider>
                    </mat-card>
                    }
                </form>
            </div>
        }@else {
            <ui-loading-progress-bar></ui-loading-progress-bar>
        }
    </mat-card-content>
    <mat-dialog-actions align="end">
        <ui-button color="primary" [disabled]="formSelectedTipo.value?.length == 0 || formSeccion.invalid" label="Guardar" class="m-r-10"
            (onClick)="onSubmit()"></ui-button>
            @if (formSelectedTipo.value?.length > 0) {
                <ui-button color="secondary" label="Cancelar" mat-dialog-close="cancelar" class="m-r-10"
                (onClick)="cancelarAdd()"></ui-button>
            }
    </mat-dialog-actions>
</mat-card>